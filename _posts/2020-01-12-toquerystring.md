---
layout: default
title: "Introducing EF Core 5 Features: Using ToQueryString to get generated SQL"
date: 2020-01-12 10:16
day: 12th
month: January
year: 2020
author: ajcvickers
permalink: 2020/01/12/toquerystring/
---

# EF Core 5: Using ToQueryString to get generated SQL

The EF team has been publishing <a href="https://github.com/dotnet/efcore/issues/19549">weekly status updates</a> since the <a href="https://github.com/dotnet/efcore/issues/15403">middle of last year</a>. Recently I have started including brief introductions for newly implemented enhancements. I'm going to experiment with blogging these brief intros to help make them more visible.

<h2>ToQueryString: A simple way to get generated SQL</h2>

EF Core 5.0 introduces the `ToQueryString` extension method which will return the SQL generated by EF Core when executing a LINQ query. For example, the code:

```C#
var city = "London";
var query = context.Customers.Where(c => c.City == city);

Console.WriteLine(query.ToQueryString());
```

results in this output when using the SQL Server database provider:

```SQL
DECLARE @__city_0 nvarchar(4000) = N&#039;London&#039;;

SELECT [c].[Id], [c].[City], [c].[CompanyName], [c].[Email], [c].[Fax], [c].[Name], [c].[Phone]
FROM [Customers] AS [c]
WHERE [c].[City] = @__city_0
```

<h3>The SQL can be executed!</h3>

Notice that declarations for parameters of the correct type are also included in the output. This allows copy/pasting to SQL Server Management Studio, or similar tools, such that the query can be executed for debugging/analysis.

<a href="https://oneunicorn.files.wordpress.com/2020/01/annotation-2020-01-12-095104.png"><img src="https://oneunicorn.files.wordpress.com/2020/01/annotation-2020-01-12-095104.png" alt="" width="640" height="277" class="alignright size-full wp-image-528" /></a>

<h3>The SQL is database-specific</h3>

Other database providers can generate parameter declarations suitable for their ecosystems. For example, the SQLite provider generates output suitable for the SQLite CLI tool:

```SQL
.param set @__city_0 &#039;London&#039;

SELECT "c"."Id", "c"."City", "c"."CompanyName", "c"."Email", "c"."Fax", "c"."Name", "c"."Phone"
FROM "Customers" AS "c"
WHERE "c"."City" = @__city_0
```

<h3>The SQL is visible in the debugger</h3>

EF Core 5 also introduces a "debug view" to easily see the generated SQL and associated expression tree in your debugger of choice. Just drill down into the EF query object and expand <code>DebugView</code>.

<a href="https://oneunicorn.files.wordpress.com/2020/01/querydebugview.png"><img src="https://oneunicorn.files.wordpress.com/2020/01/querydebugview.png" alt="" width="640" height="475" class="alignright size-full wp-image-541" /></a>
