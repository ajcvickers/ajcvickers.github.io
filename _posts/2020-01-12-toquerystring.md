<!-- ---
layout: post
title: Introducing EF Core 5 Features: Using ToQueryString to get generated SQL
date: 2020-01-12 10:16
author: ajcvickers
comments: true
categories: [EF Core, Entity Framework]
/2020/01/12/toquerystring/
---
The EF team has been publishing <a href="https://github.com/dotnet/efcore/issues/19549">weekly status updates</a> since the <a href="https://github.com/dotnet/efcore/issues/15403">middle of last year</a>. Recently I have started including brief introductions for newly implemented enhancements. I'm going to experiment with blogging these brief intros to help make them more visible.

<h2>ToQueryString: A simple way to get generated SQL</h2>

EF Core 5.0 introduces the <code>ToQueryString</code> extension method which will return the SQL generated by EF Core when executing a LINQ query. For example, the code:

[code lang=CSharp]
var city = &quot;London&quot;;
var query = context.Customers.Where(c =&gt; c.City == city);

Console.WriteLine(query.ToQueryString());
[/code]

results in this output when using the SQL Server database provider:

[code lang=SQL]
DECLARE @__city_0 nvarchar(4000) = N&#039;London&#039;;

SELECT [c].[Id], [c].[City], [c].[CompanyName], [c].[Email], [c].[Fax], [c].[Name], [c].[Phone]
FROM [Customers] AS [c]
WHERE [c].[City] = @__city_0
[/code]

<h3>The SQL can be executed!</h3>

Notice that declarations for parameters of the correct type are also included in the output. This allows copy/pasting to SQL Server Management Studio, or similar tools, such that the query can be executed for debugging/analysis.

<a href="https://oneunicorn.files.wordpress.com/2020/01/annotation-2020-01-12-095104.png"><img src="https://oneunicorn.files.wordpress.com/2020/01/annotation-2020-01-12-095104.png" alt="" width="640" height="277" class="alignright size-full wp-image-528" /></a>

<h3>The SQL is database-specific</h3>

Other database providers can generate parameter declarations suitable for their ecosystems. For example, the SQLite provider generates output suitable for the SQLite CLI tool:

[code lang=SQL]
.param set @__city_0 &#039;London&#039;

SELECT &quot;c&quot;.&quot;Id&quot;, &quot;c&quot;.&quot;City&quot;, &quot;c&quot;.&quot;CompanyName&quot;, &quot;c&quot;.&quot;Email&quot;, &quot;c&quot;.&quot;Fax&quot;, &quot;c&quot;.&quot;Name&quot;, &quot;c&quot;.&quot;Phone&quot;
FROM &quot;Customers&quot; AS &quot;c&quot;
WHERE &quot;c&quot;.&quot;City&quot; = @__city_0
[/code]

<h3>The SQL is visible in the debugger</h3>

EF Core 5 also introduces a "debug view" to easily see the generated SQL and associated expression tree in your debugger of choice. Just drill down into the EF query object and expand <code>DebugView</code>.

<a href="https://oneunicorn.files.wordpress.com/2020/01/querydebugview.png"><img src="https://oneunicorn.files.wordpress.com/2020/01/querydebugview.png" alt="" width="640" height="475" class="alignright size-full wp-image-541" /></a>

<hr />

Note: I do not monitor comments on my blogs for several reasons. Please go through the normal process on <a href="https://github.com/dotnet/efcore">EF Core GutHub repo</a> if you have questions or comments on these enhancements. -->
